#!/bin/sh

# post-merge hook
# Runs after a successful merge

echo "ğŸ”„ Post-merge: Checking for updates..."

# Check if package.json or bun.lockb changed in the merge
CHANGED_FILES=$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD)

if echo "$CHANGED_FILES" | grep -E "(package\.json|bun\.lockb)" > /dev/null; then
  echo "ğŸ“¦ Dependencies changed in merge. Installing..."
  bun install
fi

# Always rebuild after a merge to ensure everything is in sync
echo "ğŸ”¨ Rebuilding project..."
bunx turbo build

# Run tests to ensure merge didn't break anything
echo "ğŸ§ª Running tests..."
bunx turbo test

echo "âœ… Post-merge complete!"