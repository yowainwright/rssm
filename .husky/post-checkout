#!/bin/sh

# post-checkout hook
# $1: Previous HEAD
# $2: New HEAD
# $3: 1 if checking out a branch, 0 if checking out files

# Only run on branch checkouts, not file checkouts
if [ "$3" = "1" ]; then
  echo "ðŸ”„ Post-checkout: Checking for dependency changes..."
  
  # Check if package.json or bun.lockb changed
  if git diff --name-only "$1" "$2" | grep -E "(package\.json|bun\.lockb)" > /dev/null; then
    echo "ðŸ“¦ Dependencies changed. Installing..."
    bun install
  fi
  
  # Check if any source files changed that would require a rebuild
  if git diff --name-only "$1" "$2" | grep -E "\.(ts|tsx|js|jsx)$" > /dev/null; then
    echo "ðŸ”¨ Source files changed. Building..."
    bunx turbo build
  fi
  
  echo "âœ… Post-checkout complete!"
fi